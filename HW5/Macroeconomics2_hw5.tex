%各自の環境に応じて修正
%\documentclass[a4paper,11pt]{jarticle}
\documentclass{ltjsarticle}

\usepackage{enumitem}
\usepackage{appendix}
\usepackage{float}
\usepackage{bm}
\usepackage[dvipdfmx]{graphicx}
\usepackage[dvipdfmx]{color}
\usepackage{tikz}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage[american]{babel}
\usepackage{subcaption}
\usepackage{tabularx}
\usepackage{graphics}
\usepackage{physics}
\usepackage{mathtools}
\usepackage{amssymb,amsmath,amsfonts,eurosym,geometry,graphicx,caption,color,setspace,comment,footmisc,caption,pdflscape,array,hyperref}
\usepackage{booktabs}
\usepackage{siunitx}
\newcolumntype{d}{S[
    input-open-uncertainty=,
    input-close-uncertainty=,
    parse-numbers = false,
    table-align-text-pre=false,
    table-align-text-post=false
]}
\usepackage{listings} 
\usepackage{xcolor}
\lstdefinestyle{matlab}{
  language=Matlab,
  basicstyle=\ttfamily\footnotesize,
  keywordstyle=\color{blue},
  stringstyle=\color{red},
  commentstyle=\color{green!60!black},
  numbers=left,
  numberstyle=\tiny\color{gray},
  stepnumber=1,
  frame=single,
  breaklines=true,
  showstringspaces=false
}

 
\usepackage{titlesec}
\titleformat*{\section}{\Large\rmfamily}
\titleformat*{\subsection}{\large\rmfamily}
\titleformat*{\subsubsection}{\rmfamily}
 

%テキストの表示領域の調節
\setlength{\textwidth}{\paperwidth}
\addtolength{\textwidth}{-40truemm}
\setlength{\textheight}{\paperheight}
\addtolength{\textheight}{-45truemm}

%余白の調節
\setlength{\topmargin}{-10.4truemm}
\setlength{\evensidemargin}{-5.4truemm}
\setlength{\oddsidemargin}{-5.4truemm}
\setlength{\headheight}{17pt}
\setlength{\headsep}{10mm}
\addtolength{\headsep}{-17pt}
\setlength{\footskip}{5mm}

% \renewcommand{\thesection}{\Alph{section}}
% \renewcommand{\thesubsection}{\alph{subsection}}


\title{Macroeconomics $\mathrm{II}$ Homework 5}
\date{\today}
\author{Graduate School of Economics, The University of Tokyo\\[4mm]29--246029 Rin NITTA\\ 29-246033 Rei HANARI \\ 29--246004 Kosuke IGARASHI}

\begin{document}
\maketitle

\section{} %1
\subsection*{(a)}
An allocation $c_1^0, \{ c_t^t, c_{t+1}^t \}_{t=1}^\infty$ is feasible Pareto optimal if there is no other feasible allocation $\hat{c_1^0}, \{ \hat{c_t^t}, \hat{c_{t+1}^t} \}_{t=1}^\infty$ such that\\
\begin{align*}
  \frac{(\hat{c_t^t})^{1 - \gamma}}{1 - \gamma} + \frac{(\hat{c_{t+1}^t})^{1 - \gamma}}{1 - \gamma} \geq \frac{(c_t^t)^{1 - \gamma}}{1 - \gamma} + \frac{(c_{t+1}^t)^{1 - \gamma}}{1 - \gamma} \text{ for all } t \geq 1\\
  \frac{(\hat{c_1^0})^{1 - \gamma}}{1 - \gamma} \geq \frac{(c_1^0)^{1 - \gamma}}{1 - \gamma}\\
  \text{with strict inequality for at least one }t \geq 0.\\
  \text{with }c_t^{t-1}, c_t^t &\geq 0 \text{ for all } t \geq 1\\
  c_t^{t-1} + c_t^t &\geq 0 e_t^{t-1} + e_t^t \text{ for all } t \geq 1\\ 
\end{align*}

\subsection*{(b)}
an Arrow-Debreu compepetive equilibrium is an allocation $\hat{c_1^0}, \{ \hat{c_t^t}, \hat{c_{t+1}^t} \}_{t=1}^\infty$ and prices $\{ p_t \}_{t=1}^\infty$ such that\\
1. Given $\{ p_t \}_{t=1}^\infty$, for each $t \geq 1, (\hat{c_t^t}, \hat{c_{t+1}^t})$ solves\\
\begin{align*}
  \max_{(c_t^t, c_{t+1}^t) \geq 0} \frac{(c_t^t)^{1 - \gamma}}{1 - \gamma} + \frac{(c_{t+1}^t)^{1 - \gamma}}{1 - \gamma}\\
  \text{s.t. } p_t c_t^t + p_{t+1} c_{t+1}^t \leq p_t e_t^t + p_{t+1} e_{t+1}^t\\
\end{align*}
2. Given $p_1$, $\hat{C_1^0}$ solves\\
\begin{align*}
  \max_{c_1^0 \geq 0} \frac{(c_1^0)^{1 - \gamma}}{1 - \gamma}\\
  \text{s.t. } p_1 c_1^0 \leq p_1 e_1^0\\
\end{align*}
3. For all $t \geq 1$\\
\begin{align*}
  c_t^{t-1} + c_t^t = e_t^{t-1} + e_t^t \text{ for all } t \geq 1\\
\end{align*}

\subsection*{(c)}
Define the excess demand functions:
\begin{align*}
  y(p_t, p_{t+1}) = c_t^t(p_t, p_{t+1}) = \omega_1\\
  z(p_t, p_{t+1}) = c_{t+1}^t(p_t, p_{t+1}) = \omega_2\\
\end{align*}
Since $c_t^t(p_t, p_{t+1} \geq 0)$ and $c_{t+1}^t(p_t, p_{t+1}) \geq 0$,\\
$y(p_t, p_{t+1}) \geq - \omega_1$ and $z(p_t, p_{t+1}) \geq -\omega_2$ holds.\\
Since the optimal choice satisfies the budget constraint\\
\begin{align*}
  p_t y(p_t, p_{t+1}) + p_{t+1} z(p_t, p_{t+1}) = 0
\end{align*}
So we have 
\begin{align*}
  \frac{z(p_t, p_{t+1})}{y(p_t, p_{t+1})} = - \frac{p_t}{p_{t+1}}
\end{align*}
Now, $U(c_t) = \frac{(c_t)^{1 - \gamma}}{1 - \gamma}$ $(\gamma \neq 1)$ is CRRA utility function, so the equilibrium is unique.

\subsection*{(d)}
Now, $U(c_t) = \log c_t$.\\
In the PAYG social security system, $b = \tau (1 + n)$ holds.\\
The FOCs imply $p_t c_t^t = p_{t+1} c_{t+1}^t$.\\
Then, the AD competitive equilibrium is an allocation
\begin{align*}
  c_1^0 = \log \omega_2\\
  c_t^t(p_t, p_{t+1}) = \frac{1}{2} \[ \omega_1 - \tau + n(\omega_2 + \tau (1 + n)) \]\\
  c_{t+1}^t(p_t, p_{t+1}) = \frac{1}{2} \[ \frac{\omega_1 - \tau}{n} + \omega_2 + \tau (1 + n) \]
\end{align*}

\subsection*{(e)}
The ADE is autarky with endowments of $(\omega_1 - \tau, \omega_2 + \tau (1 + n))$ and interest rate $r$.\\
\begin{align*}
  1 + r_{t+1} = 1 + r = \frac{\omega_2 + \tau (1 + n)}{\omega_1 - \tau}
\end{align*}

For generations $t \geq 1$, the equilibrium utility as a function of social security tax $\tau$ is\\
\begin{align*}
  V(\tau) = \log(\omega_1 - \tau) + \log(\omega_2 + \tau (1 + n))
\end{align*}
Social security of size $\tau^*$ maximizes welfare of generation $t \geq 1$ when\\
\begin{align*}
  1 + n = \frac{\omega_2 + \tau^* (1 + n)}{\omega_1 - \tau^*}
\end{align*}
Therefore,\\
\begin{align*}
  \tau^* = \frac{1}{2}\omega_1 - \frac{\omega_2}{2(1 + n)}
\end{align*}

\subsection*{(f)}
\begin{align*}
  V(\tau) = \log(\omega_1 - \tau) + \log(\omega_2 + \tau (1 + n))
\end{align*}
The introduction of small social security system is welfare improving for the  initial young and future generations if and only if $V\prime (\tau) > 0$, evaluated at $\tau = 0$, is positive.\\
\begin{align*}
  V\prime (0) = -\frac{1}{\omega_1} + \frac{1 + n}{\omega_2}
\end{align*}
Then, $V\prime (0) > 0 \text{ if and only if } n > \frac{\omega_2}{\omega_1} - 1 = \bar{r}$.\\
$\bar{r}$ is the autarkic interest rate.\\
Therefore, a decrease in $n$ reduces the welfare gains from social security, leading to a reduction in the optimal level of the PAYG social security system.

\section{} %2
\subsection{(a)}
SMW is a allocation $\hat{c}^1_0,\ \{\hat{c}^t_t,\ \hat{c}^t_{t+1},\ \hat{s}^t_t \}$ and interest rate $\qty{r_{t+1}}^{\infty}_{t=1}$ such that
\begin{itemize}
  \item[1] Given $\qty{r_{t+1}}^{\infty}_{t=1}$, for each $t\geq 1$, $(\hat{c}^t_t,\ \hat{c}^t_{t+1},\ \hat{s}^t_t)$ solves\\
\begin{align*}
  max_{{c}^t_t,\ {c}^t_{t+1}} \ln(c^t_t) + \ln(c^t_{t+1})\\
  s.t.\ \ c^t_t + s^t_t = w_1\\
  c^t_{t+1} +  = w_1  + s^t_t(1+r_{t+1})\\
  c^t_t,c^t_{t+1} \geq 0.
\end{align*}
  \item[2]  Given $\qty{r_{t+1}}^{\infty}_{t=1}$, for each  $c^0_1$ solves\\
  \begin{align*}
    max_{c^0_1} \ln(c^0_1) \\
    s.t.\ \ c^0_1  = w_2 + m(1+r_1)\\
    c^0_1\geq 0
  \end{align*}
  \item[3] Market clear\\
   \begin{align*}
    c^t_{t+1} + c^{t+1}_{t+1} =\omega_1+ \omega_2. 
   \end{align*} 
\end{itemize}

\subsection{(b)}
For $t\geq 1$, let $L^t = \ln(\omega_1-s^t_t) + \ln(\omega_2 + s^t_t(1+r_{t+1})) $.
From FOC with respect to $s^t_t$ 
\begin{align*}
  \frac{1}{\omega_1 - s^t_t} &=\frac{1+r_{t+1}}{\omega_2 + s^2_2(1+r_{t+1})}\\
  \hat{s}^t_t &= \frac{\omega_1}{2} - \frac{\omega_2}{2(1+r_{t+1})}
\end{align*}

From maket clear, 
\begin{align*}
  s^t_{t+1} = s^t_t (1+r_{t+1}) = m \prod^{t}_{j=0}(1+r_{j+1})
\end{align*}


\subsection{(c)}
There are infitnitely many equilibrium.

From constraint,
\begin{align*}
  \forall\ t\geq 1\ \  -\frac{\omega_2}{1+r_{t+1}} \leq \hat{s}^t_t \leq \omega_1.
\end{align*}

As  $s^1_1 =  (1+r_1)m$, any $r_1$ that satisfy
\begin{align*}
  \frac{-\omega_2}{1+r_{t+1}} \leq (1+r_1)m \leq \omega_1
\end{align*}
makes equilibrium. Thus there are infitnitely many equilibrium.


One. From market clear, $s^t_t(1+r_{t+1}) + s^{t+1}_{t+1}=0$, only $r_{t+1}$ lead to stationary equilibrium.

\section{} %3

\subsection*{(a)}

Suppose the market structure is sequential markets. Then the competitive equilibrium is given as a sequential market equilibrium.
Let $\bar{k}_1$ be the capital stock of the initial old. Suppose $g_0 = 0$.

Given $\bar{k}_1$, sequential markets equilibrium is allocations for households $\hat{c}_1^0, \{\hat{c}_t^t, \hat{c}_{t+1}^t, \hat{s}_t^t \}_{t=0}^{\infty}$, allocations fot the firm $\{\hat{K}_t, \hat{L}_t\}_{t=0}^{\infty}$, and prices $\{\hat{r}_t, \hat{w}_t\}_{t=0}^{\infty}$ such that
\begin{enumerate}
  \item For all $t \geq 0$, given $(\hat{w}_t, \hat{r}_{t+1})$, $(\hat{c}_t^t, \hat{c}_{t+1}^t, \hat{s}_t^t)$ solve the household's optimization problem:
  \begin{gather*}
    \max_{(c_t^t, c_{t+1}^t) \geq 0, \: s_t^t} \log c_t^t + \beta \log c_{t+1}^t \\
    \text{s.t.} \qquad c_t^t + s_t^t + \tau_t \leq \hat{w}_t \\
    c_{t+1}^t \leq (1 + \hat{r}_{t+1} - \delta) s_t^t - b_{t+1}
  \end{gather*}
  \item Given $\bar{k}_1$ and $\hat{r}_1$, $\hat{c}_1^0$ solves the household's optimization problem:
  \begin{gather*}
    \max_{c_1^0 \geq 0} \log c_1^0 \\
    \text{s.t.} \quad c_1^0 \leq (1 + \hat{r}_1 - \delta) \bar{k}_1
  \end{gather*}
  \item For all $t \geq 1$, given $(\hat{r}_t, \hat{w}_t)$, $(\hat{K}_t, \hat{L}_t)$ solves the firm's optimization problem:
  \begin{gather*}
    \max_{(K_t, L_t) \geq 0} K_t^\alpha L_t^{1-\alpha} - \hat{r}_t K_t - \hat{w}_t L_t
  \end{gather*}
  \item For all $t \geq 1$,
  \begin{itemize}
    \item Goods market: $N_t \hat{c}_t^t + N_{t-1} \hat{c}_t^{t-1} + \hat{K}_{t+1} - (1-\delta) \hat{K}_t  = \hat{K}_t^\alpha \hat{L}_t^{1-\alpha}$
    \item Asset market: $N_t \hat{s}_t^t + N_t g_t = \hat{K}_{t+1}$
    \item Labor market: $N_t = \hat{L}_t$
  \end{itemize}
\end{enumerate}
where $\tau_t = g_t$ and $b_t = -(1 + r_t - \delta) g_{t-1}$ for all $t \geq 1$.

\subsection*{(b)}

Using $\tau_t = g_t$ and $b_t = -(1 + r_t - \delta) g_{t-1}$, the budget constraint of the household is rewritten as
\begin{gather*}
  c_t^t + s_t^t + g_t \leq \hat{w}_t\\
  c_{t+1}^t \leq (1 + \hat{r}_{t+1} - \delta) (s_t^t +  g_t)
\end{gather*}
and the market clearing condition of the asset market is rewritten as
\begin{gather*}
  N_t (s_t^t + g_t )= \hat{K}_{t+1}
\end{gather*}
These are the same as the budget constraint and the market clearing condition in the model without the government, except that $s_t^t$ is replaced by $s_t^t + g_t$. Then, if the household doesnt' care about the borrowing constraint, the competitive equilibrium is the same as the competitive equilibrium in the model without the government.

\subsection*{(c)}



Given $\bar{k}_1$, sequential markets equilibrium is allocations for households $\hat{c}_1^0, \{\hat{c}_t^t, \hat{c}_{t+1}^t, \hat{s}_t^t \}_{t=0}^{\infty}$, allocations fot the firm $\{\hat{K}_t, \hat{L}_t\}_{t=0}^{\infty}$, and prices $\{\hat{r}_t, \hat{w}_t\}_{t=0}^{\infty}$ such that
\begin{enumerate}
  \item For all $t \geq 0$, given $(\hat{w}_t, \hat{r}_{t+1})$, $(\hat{c}_t^t, \hat{c}_{t+1}^t, \hat{s}_t^t)$ solve the household's optimization problem:
  \begin{gather*}
    \max_{(c_t^t, c_{t+1}^t) \geq 0, \: s_t^t} \log c_t^t + \beta \log c_{t+1}^t \\
    \text{s.t.} \qquad c_t^t + s_t^t + \tau_t \leq \hat{w}_t \\
    c_{t+1}^t \leq (1 + \hat{r}_{t+1} - \delta) s_t^t + b_{t+1}
  \end{gather*}
  \item Given $\bar{k}_1$ and $\hat{r}_1$, $\hat{c}_1^0$ solves the household's optimization problem:
  \begin{gather*}
    \max_{c_1^0 \geq 0} \log c_1^0 \\
    \text{s.t.} \quad c_1^0 \leq (1 + \hat{r}_1 - \delta) \bar{k}_1
  \end{gather*}
  \item For all $t \geq 1$, given $(\hat{r}_t, \hat{w}_t)$, $(\hat{K}_t, \hat{L}_t)$ solves the firm's optimization problem:
  \begin{gather*}
    \max_{(K_t, L_t) \geq 0} K_t^\alpha L_t^{1-\alpha} - \hat{r}_t K_t - \hat{w}_t L_t
  \end{gather*}
  \item For all $t \geq 1$,
  \begin{itemize}
    \item Goods market: $N_t \hat{c}_t^t + N_{t-1} \hat{c}_t^{t-1} + \hat{K}_{t+1} - (1-\delta) \hat{K}_t  = \hat{K}_t^\alpha \hat{L}_t^{1-\alpha}$
    \item Asset market: $N_t \hat{s}_t^t = \hat{K}_{t+1}$
    \item Labor market: $N_t = \hat{L}_t$
  \end{itemize}
\end{enumerate}
where $(1+n)\tau_t = (1+n)\tau_y =b_t$ for all $t \geq 1$.

\subsection*{(d)}

If $\tau_y$ rises, then $(1+n)\tau_y = b_t$ rises. Then, the households receive more transfer from the government when they are old. For consumption smoothing, the households save less when they are young, that is, $s_t^t$ decreases. Then, by the asset market clearing, $N_t s_t^t = K_{t+1}$ decreases. Therefore, he steady-state capital-labor ratio $k_t = \frac{K_t}{N_t}$ decreases.

\section{} %4

\subsection*{(a)}

Let $V(a_{i,0}, n_{i,0}) = E_0 \left[\max_{\{c_{i,t}\}_{t=0}^{\infty}} \sum_{t=0}^{\infty} \beta^t u(c_{i,t})\right]$ be the value function of the household. The Bellman equation is given by
\begin{align*}
    V(a_{i,0}, n_{i,0}) 
    &= E_0 \left[\max_{\{c_{i,t}\}_{t=0}^{\infty}} \sum_{t=0}^{\infty} \beta^t u(c_{i,t}) \right] \\
    &= \max_{c_{i,0}, a_{i,1}} u(c_{i,0}) + E_0 \left[ \max_{\{c_{i,t}\}_{t=1}^{\infty}} \sum_{t=1}^{\infty} \beta^t u(c_{i,t}) \right] \\
    &= \max_{c_{i,0}, a_{i,1}} u(c_{i,0}) + \beta E_0 \left[E_1 \left[\max_{\{c_{i,t+1}\}_{t=0}^{\infty}} \sum_{t=0}^{\infty} \beta^t u(c_{i,t+1}) \right] \right] \\
    &= \max_{c_{i,0}, a_{i,1}} u(c_{i,0}) + \beta E_0 [V(a_{i,1}, n_{i,1}) ]\\
\end{align*}
Then, the recursive problem is given by
\begin{gather*}
  V(a,n) = \max_{c, a'} u(c) + \beta E[V(a', n')] 
\end{gather*}
where $a$ and $n$ are state variables, and $a'$ and $c$ are control variables.

\subsection*{(b)}
Let $m(a,n)$ be a measure of households in state $(a,n)$.

A stationary competitive equilibrium is a policy function $a' = g(a,n)$, a distribution $m(a,n)$, and real numbers $K, r$ and $w$ such that

\begin{enumerate}
  \item prices are determined competitively, that is, $r = F_K (K,N) - \delta = \alpha K_t^{\alpha-1} N_t^{1-\alpha} - \delta$ and $w = F_L (K, N) = (1-\alpha) K_t^\alpha N_t^{-\alpha}$.
  \item The policy function $a' = g(a,n)$ solves the household's optimization problem.
  \item The probability distribution $m(a,n)$ is stationary and associated with the policy function $g(a,n)$ and the distribution of $n$.
  \item The capital $K$ equals the sum of households' savings:
    \begin{gather*}
      K = \sum_a \sum_n g(a,n) \cdot m(a,n)
    \end{gather*}
    The labor $N$ equals the sum of labor supplied by each household (exogenous):
    \begin{gather*}
      L = \sum_a \sum_n n \cdot m(a,n)
    \end{gather*}   
\end{enumerate}

\subsection*{(c)}

The grid $Z$, the transition matrix $P$, and the stationary distribution $\pi$ gained by Tauchen's method are as follows:
\begin{gather*}
    Z = \begin{pmatrix}
        -0.8000\\
        -0.5333\\
        -0.2667
              0\\
        0.2667\\
        0.5333\\
        0.8000
    \end{pmatrix}
    , \quad
    P = \begin{pmatrix}
        0.5530 & 0.2351 & 0.1406 & 0.0548 & 0.0139 & 0.0023 & 0.0003\\
        0.3204 & 0.2589 & 0.2277 & 0.1305 & 0.0487 & 0.0118 & 0.0021\\
        0.1431 & 0.2015 & 0.2606 & 0.2195 & 0.1205 & 0.0431 & 0.0117\\
        0.0478 & 0.1109 & 0.2108 & 0.2611 & 0.2108 & 0.1109 & 0.0478\\
        0.0117 & 0.0431 & 0.1205 & 0.2195 & 0.2606 & 0.2015 & 0.1431\\
        0.0021 & 0.0118 & 0.0487 & 0.1305 & 0.2277 & 0.2589 & 0.3204\\
        0.0003 & 0.0023 & 0.0139 & 0.0548 & 0.1406 & 0.2351 & 0.5530
    \end{pmatrix}
    , \quad
    \pi = \begin{pmatrix}
        0.1553\\
        0.1226\\
        0.1456\\
        0.1529\\
        0.1456\\
        0.1226\\
        0.1553
    \end{pmatrix}
\end{gather*}

The Matlab code is below.

\noindent\textbf{Code: tauchen.m}
\lstset{style=matlab}
\begin{lstlisting}
function [Z,Zprob] = tauchen(N,mu,rho,sigma)

  Zprob = zeros(N,N); % Transition Matrix
  c = (1-rho)*mu; % Constant

  % Define Grids 
  zmax  = 2*sigma;
  zmin  = -zmax;
  w = (zmax-zmin)/(N-1);
  Z = linspace(zmin,zmax,N)';

  % Stationary value, mu
  Z = Z + mu;

  % Create Transition Matrix
  for j = 1:N
      for k = 1:N
          if k == 1
              Zprob(j,k) = normcdf((Z(1)-c-rho*Z(j)+w/2)/sigma);
          elseif k == N
              Zprob(j,k) = 1 - normcdf((Z(N)-c-rho*Z(j)-w/2)/sigma);
          else
              Zprob(j,k) = normcdf((Z(k)-c-rho*Z(j)+w/2)/sigma) - normcdf((Z(k)-c-rho*Z(j)-w/2)/sigma);
          end
      end
  end
end
\end{lstlisting}

\noindent\textbf{Code: tauchen\_result.m}
\lstset{style=matlab}
\begin{lstlisting}
N = 7; % Number of Grid Points, the number of potential realizations of z.
mu = 0; % Mean
rho = 0.9; % AR(1) Coefficient
sigma = 0.4; % Standard Deviation

[Z,Zprob] = tauchen(N,mu,rho,sigma);

disp('Grid (Z):');
disp(Z);

disp('Transition matrix (P):');
disp(Zprob);

[V, D] = eig(Zprob');
[~, idx] = max(abs(diag(D)));
pi = V(:, idx); 
pi = pi / sum(pi);

disp('stationary distribution:');
disp(pi);
\end{lstlisting}

\end{document}